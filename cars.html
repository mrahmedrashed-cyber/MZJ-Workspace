
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <link rel="icon" type="image/x-icon" href="assets/favicon.png">
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>MZJ — Production Tracker (Firestore)</title>

  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="mzj-ui.css"/>

  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<style>
  :root{
    --brown:#3e2420; --beige:#bc8f74; --cream:#fff8ef; --text:#1f2937; --muted:#6b7280; --danger:#ef4444; --shadow:0 6px 20px rgba(0,0,0,.06);
    /* قيَم التضييق */
    --w-brand:90px; --w-model:120px; --w-trim:100px; --w-engine:110px; --w-actions:108px;
    --tbl-font:11px; --tbl-pad:6px; --inp-h:30px; --btn-pad:4px 8px;
    --link-max:120px;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--cream);color:var(--text);font-family:"Tajawal",system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;line-height:1.7}
  .container{max-width:1280px;margin:24px auto;padding:0 16px}
  .topbar{background:linear-gradient(135deg, rgba(62,36,32,.96), rgba(62,36,32,.85));color:#fff;border-radius:16px;padding:20px 18px;box-shadow:var(--shadow);display:flex;align-items:center;justify-content:space-between;gap:12px}
  .logo{width:42px;height:42px;border-radius:10px;background:var(--beige);display:grid;place-items:center;color:#fff;font-weight:800;box-shadow:inset 0 0 0 2px rgba(255,255,255,.35)}
  h1{margin:0;font-size:20px}
  .muted{color:#e8d9cf;font-size:12px}
  .actions{display:flex;gap:8px;flex-wrap:wrap}
  button,.btn{border:0;border-radius:12px;padding:10px 14px;font-weight:700;cursor:pointer}
  .btn-primary{background:var(--beige);color:#fff}
  .btn-secondary{background:#ffffff1a;color:#fff;border:1px solid #ffffff3a}
  .btn-ghost{background:#fff;color:var(--brown);border:1px solid #ece1d9}
  .btn-danger{background:var(--danger);color:#fff}

  .panel{background:#fff;border:1px solid #f0e6df;border-radius:16px;box-shadow:var(--shadow);padding:16px;margin-top:14px}
  .grid{display:grid;gap:12px}
  .grid-4{grid-template-columns:repeat(4,1fr)}
  @media (max-width:1100px){ .grid-4{grid-template-columns:repeat(2,1fr)} }
  @media (max-width:640px){ .grid-4{grid-template-columns:1fr} }
  .card{background:#fff;border:1px solid #f0e6df;border-radius:14px;padding:14px;box-shadow:var(--shadow)}
  .metric{display:flex;align-items:center;justify-content:space-between}
  .metric h3{margin:0;font-size:14px;color:var(--muted)}
  .metric strong{font-size:22px}
  label{font-weight:700;font-size:13px;color:var(--brown);display:block;margin-bottom:6px}
  input,select{width:100%;padding:10px 12px;border-radius:12px;border:1px solid #e7dbd2;background:#fff;outline:none;font-size:14px;appearance:auto}
  input:focus,select:focus{border-color:var(--beige);box-shadow:0 0 0 3px rgba(188,143,116,.18)}
  .row{display:grid;grid-template-columns:repeat(6,1fr);gap:10px}
  @media (max-width:1100px){ .row{grid-template-columns:repeat(3,1fr)} }
  @media (max-width:640px){ .row{grid-template-columns:1fr} }

  /* ===== جداول مضغوطة ===== */
  .table-soft{overflow:auto;border-radius:16px;border:1px solid #f0e6df}
  table{width:100%;border-collapse:separate;border-spacing:0;background:#fff;table-layout:fixed;min-width:1100px}
  thead th{position:sticky;top:0;background:#fbf6f1;color:var(--brown);padding:var(--tbl-pad);border-bottom:1px solid #f0e6df;font-size:var(--tbl-font);z-index:3;text-align:right;white-space:nowrap}
  tbody td{padding:var(--tbl-pad);border-bottom:1px solid #f7eee7;font-size:var(--tbl-font);vertical-align:middle;background:#fff}
  tbody tr:nth-child(even) td{background:#fffdfa}

  /* أعمدة مثبتة */
  .sticky-brand{position:sticky; inset-inline-start:0; min-width:var(--w-brand); z-index:4; background:#fbf6f1}
  .sticky-model{position:sticky; inset-inline-start:var(--w-brand); min-width:var(--w-model); z-index:4; background:#fbf6f1}
  .sticky-trim{position:sticky; inset-inline-start:calc(var(--w-brand) + var(--w-model)); min-width:var(--w-trim); z-index:4; background:#fbf6f1}
  .sticky-actions{position:sticky; inset-inline-end:0; min-width:var(--w-actions); z-index:4; background:#fbf6f1}
  tbody td.sticky-brand,tbody td.sticky-model,tbody td.sticky-trim,tbody td.sticky-actions{background:#fff}

  /* خلايا أضيق + روابط مختصرة */
  .narrow-90{width:90px}
  .narrow-100{width:100px}
  .narrow-110{width:110px}
  .narrow-120{width:120px}
  .narrow-130{width:130px}
  td, th{overflow:hidden;text-overflow:ellipsis}
  td a{white-space:nowrap; display:inline-block; max-width:var(--link-max); overflow:hidden; text-overflow:ellipsis}

  /* مدخلات وأزرار أصغر داخل الجدول */
  td input, td select{height:var(--inp-h); padding:0 6px; font-size:11px}
  td .btn, td button{padding:var(--btn-pad); font-size:11px; border-radius:10px}

  .pill{display:inline-block;padding:4px 8px;border-radius:999px;border:1px solid #eaded6;font-weight:700;font-size:11px;background:#fff;white-space:nowrap}
  .p-green{background:#ecfdf5;border-color:#a7f3d0}
  .p-orange{background:#fff7ed;border-color:#fed7aa}
  .p-gray{background:#f3f4f6;border-color:#e5e7eb}

  .hidden{display:none}

  /* ===== Navbar ===== */
  .nav{
    margin:12px 0 0 0;
    background:#fff;border:1px solid #f0e6df;border-radius:12px;box-shadow:var(--shadow);
    padding:8px;display:flex;gap:8px;flex-wrap:wrap;align-items:center
  }
  .nav a{
    display:inline-block;padding:10px 12px;border-radius:10px;
    text-decoration:none;font-weight:700;font-size:14px;
    color:var(--brown);border:1px solid #eaded6;background:#fff
  }
  .nav a:hover{background:#fff8f2}
  .nav a.active{background:rgba(62,36,32,.06);border-color:#e1d2c8}
  .nav a.logout{color:#fff;background:var(--danger);border-color:var(--danger)}

  /* ===== Toasts + فلاش الصف ===== */
  .toasts{position:fixed; inset-inline-end:16px; inset-block-end:16px; z-index:9999; display:flex; flex-direction:column; gap:8px; pointer-events:none;}
  .toast{pointer-events:auto;background:#fff; border:1px solid #eee; box-shadow:var(--shadow); border-radius:12px; padding:12px 14px; font-weight:700; color:#fff; display:flex; align-items:center; gap:10px; min-width:260px; animation:slideIn .24s.ease-out;}
  .toast.success{border-color:#bbf7d0; background:#16a34a}
  .toast.warn{border-color:#fde68a; background:#d97706}
  .toast.error{border-color:#fecaca; background:#dc2626}
  .toast button{margin-inline-start:auto; background:#ffffff22; color:#fff}
  @keyframes slideIn{from{opacity:0; transform:translateY(8px)} to{opacity:1; transform:translateY(0)}}
  .row-flash{animation: flashRow 1.6s ease-out 1;}
  @keyframes flashRow{0%{ background:#fffde7 }30%{ background:#fff2b3 }60%{ background:#fffde7 }100%{ background:#fff }}
</style>
  <style>
    /* إخفاء شريط الصفحة القديم بعد توحيد القالب */
    .topbar, .nav { display:none !important; }
    /* ضمان عرض المحتوى بنفس اتساع الصفحة السابقة */
    .mzj-content .container { max-width:1280px; margin:24px auto; padding:0 16px; }
  </style>
</head>

<body class="mzj">
  <header class="mzj-topbar">
    <div class="topbar-left">
      <button class="icon-btn" id="mzjSidebarBtn" aria-label="القائمة"><i class="fa-solid fa-bars"></i></button>
      <div class="brand">
        <div class="brand-mark">MZJ</div>
        <div class="brand-text">
          <div class="brand-title">محمد بن ذعار العجمي للسيارات</div>
          <div class="brand-sub">Workspace</div>
        </div>
      </div>
    </div>
    <div class="topbar-center">
      <div class="mzj-breadcrumb">
        <span class="crumb">الرئيسية</span>
        <i class="fa-solid fa-chevron-left"></i>
        <span class="crumb current">متابعة السيارات</span>
      </div>
    </div>
    <div class="topbar-right">
      <div class="mzj-chip"><i class="fa-regular fa-clock"></i><span id="mzjNow">—</span></div>
      <button class="mzj-btn mzj-btn-ghost" id="btnLogout" type="button">
        <i class="fa-solid fa-right-from-bracket"></i>
        <span>تسجيل الخروج</span>
      </button>
      <div class="mzj-user">
        <div class="avatar">CR</div>
        <div class="user-text">
          <div class="user-name">متابعة السيارات</div>
          <div class="user-role">Cars</div>
        </div>
      </div>
    </div>
  </header>

  <div class="mzj-shell" id="mzjShell">
    <aside class="mzj-sidebar" id="mzjSidebar">
      <div class="side-section">
        <div class="side-title">التنقّل</div>
        <div class="side-nav">
          <a class="side-link" href="dashboard.html"><i class="fa-solid fa-gauge"></i><span>لوحة التحكم</span></a>
          <a class="side-link" href="projects.html"><i class="fa-solid fa-folder-open"></i><span>المشاريع</span></a>
          <a class="side-link" href="members.html"><i class="fa-solid fa-users"></i><span>الأعضاء</span></a>
          <a class="side-link" href="admin.html"><i class="fa-solid fa-bullhorn"></i><span>الحملات</span></a>
          <a class="side-link active" href="cars.html"><i class="fa-solid fa-car"></i><span>متابعة السيارات</span></a>
          <a class="side-link" href="Whiteboard.html"><i class="fa-solid fa-pen-ruler"></i><span>وايت بورد</span></a>
        </div>
      </div>

      <div class="side-footer">
        <div class="mzj-note">
          <div class="note-title">ملاحظة</div>
          <div class="note-row"><span class="swatch sw-brown"></span><span>مصداقية — إتقان — سرعة</span></div>
          <div class="note-row"><span class="swatch sw-beige"></span><span>قالب موحّد لكل الصفحات</span></div>
          <div class="note-row"><span class="swatch sw-cream"></span><span>Workspace</span></div>
        </div>
      </div>
    </aside>

    <div class="mzj-backdrop" id="mzjBackdrop"></div>

    <main class="mzj-content">
      <div class="mzj-pagehead">
        <div>
          <h1 class="page-title">متابعة السيارات</h1>
          <p class="page-desc">لوحة متابعة إنتاج المحتوى — Firestore.</p>
        </div>
        <div class="pagehead-right">
          <div class="muted" id="who">—</div>
        </div>
      </div>

      <!-- محتوى الصفحة الأصلي (بدون تغيير منطق) -->
      <div class="container">
<div>
          <h1>لوحة متابعة إنتاج المحتوى — Firestore</h1>
          <div class="muted" id="who">—</div>
        </div>
      </div>
      <div class="actions">
        <button id="btnWipeFS" class="btn btn-danger">تفريغ Firestore</button>
        <button id="btnExportXLSX" class="btn btn-secondary">تصدير XLSX</button>
        <label class="btn btn-secondary" for="xlsxImport" style="cursor:pointer">استيراد XLSX (إضافة)</label>
        <input id="xlsxImport" type="file" accept=".xlsx" style="display:none"/>
        <button id="btnTemplate" class="btn btn-ghost">تحميل Template XLSX</button>
      </div>
    </div>

    <!-- Navbar --><!-- KPIs -->
    <div class="grid grid-4 panel" style="margin-top:14px">
      <div class="card metric"><h3>إجمالي السيارات</h3><strong id="kTotal">0</strong></div>
      <div class="card metric"><h3>تم التصوير</h3><strong id="kShot">0</strong></div>
      <div class="card metric"><h3>تحت المونتاج</h3><strong id="kEditing">0</strong></div>
      <div class="card metric"><h3>داخل الأجندة</h3><strong id="kAgenda">0</strong></div>
    </div>

    <!-- إضافة سيارة سريعة -->
    <div class="panel" id="addPanel">
      <h2 style="margin:0 0 10px 0;color:var(--brown);font-size:18px">إضافة سيارة سريعة</h2>
      <div class="row">
        <div><label>العلامة</label><select id="iBrand"></select></div>
        <div><label>الموديل</label><select id="iModel" disabled></select></div>
        <div><label>السنة</label><input id="iYear" type="number" min="2015" max="2035" value="2026"></div>
        <div><label>الفئة</label><input id="iTrimText" placeholder="اكتب الفئة يدويًا (مثال: سمارت بلس)"></div>
        <div><label>سعة المحرك</label><input id="iEngine" placeholder="مثال: 2000 سي سي / 2.0L"></div>
        <div><label>اللون الخارجي</label><input id="iColor" placeholder="مثال: أبيض لؤلؤي"></div>
      </div>
      <div class="row" style="margin-top:10px">
        <div><label>اللون الداخلي</label><input id="iIntColor" placeholder="مثال: جلد بيج"></div>
        <div><label>Status – تصوير</label><select id="iShoot"></select></div>
        <div><label>Status – مونتاج</label><select id="iEdit"></select></div>
        <div><label>تاريخ التصوير</label><input id="iShootDate" type="date"></div>
        <div><label>داخل الأجندة؟</label><select id="iInAgenda"></select></div>
        <div><label>&nbsp;</label></div>
      </div>
      <div class="row" style="margin-top:10px">
        <div id="agendaFields" class="hidden">
          <label>تاريخ الأجندة</label>
          <div style="display:flex;gap:8px">
            <select id="iAgendaMonth"></select>
            <input id="iAgendaYear" type="number" min="2020" max="2035" value="">
          </div>
        </div>
        <div id="editExtras" class="hidden" style="grid-column: span 3">
          <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:8px">
            <div>
              <label>صور + ريل مواصفات</label>
              <select id="iPhotosSpecs"></select>
            </div>
            <div>
              <label>ريل قصير</label>
              <select id="iShortReel"></select>
            </div>
          </div>
        </div>
        <div><label>&nbsp;</label><button id="btnAdd" class="btn btn-primary" style="width:100%">إضافة</button></div>
      </div>
    </div>

    <!-- الفلاتر -->
    <div class="panel" id="filterPanel">
      <h2 style="margin:0 0 10px 0;color:var(--brown);font-size:18px">الفلاتر</h2>
      <div class="row">
        <div><label>العلامة</label><select id="dBrand"><option value="">الكل</option></select></div>
        <div><label>الموديل</label><select id="dModel"><option value="">الكل</option></select></div>
        <div><label>الفئة</label><select id="dTrim"><option value="">الكل</option></select></div>
        <div><label>تصوير</label><select id="dShoot"><option value="">الكل</option></select></div>
        <div><label>مونتاج</label><select id="dEdit"><option value="">الكل</option></select></div>
        <div><label>اللون الخارجي</label><input id="dColor" placeholder="مثال: أبيض"></div>
      </div>
      <div class="row" style="margin-top:10px">
        <div><label>اللون الداخلي</label><input id="dIntColor" placeholder="مثال: بيج"></div>
        <div><label>داخل الأجندة؟</label><select id="dAgenda"><option value="">الكل</option></select></div>
        <div style="grid-column: span 4"><label>بحث نصّي</label><input id="dSearch" placeholder="ابحث في الموديل/الملاحظات/الألوان/المحرك"></div>
      </div>
    </div>

    <!-- نتيجة الفلتر (عرض فقط) -->
    <div class="panel table-soft" id="filteredPanel" style="padding:0;margin-top:8px">
      <table id="filteredTable">
        <colgroup>
          <col style="width:var(--w-brand)"><col style="width:var(--w-model)"><col class="narrow-90">
          <col style="width:var(--w-trim)"><col style="width:var(--w-engine)">
          <col class="narrow-110"><col class="narrow-110">
          <col class="narrow-90"><col class="narrow-90"><col class="narrow-100"><col class="narrow-100">
          <col class="narrow-110"><col class="narrow-90"><col class="narrow-120"><col class="narrow-120">
        </colgroup>
        <thead>
          <tr>
            <th class="sticky-brand">العلامة</th>
            <th class="sticky-model">الموديل</th>
            <th>السنة</th>
            <th class="sticky-trim">الفئة</th>
            <th>سعة المحرك</th>
            <th>اللون الخارجي</th><th>اللون الداخلي</th>
            <th>تصوير</th><th>مونتاج</th><th>صور + ريل مواصفات</th><th>ريل قصير</th>
            <th>تاريخ التصوير</th><th>داخل الأجندة؟</th><th>مرفوع؟</th>
            <th>رابط الصفحة</th><th>ملاحظات</th>
          </tr>
        </thead>
        <tbody id="filteredTBody"></tbody>
      </table>
      <div class="muted" id="flatMeta" style="padding:10px"></div>
    </div>

    <!-- جدول السيارات (تحرير) -->
    <div class="panel table-soft" id="editorPanel" style="padding:0;margin-top:8px">
      <table id="carsTable">
        <colgroup>
          <col style="width:var(--w-brand)"><col style="width:var(--w-model)"><col class="narrow-90">
          <col style="width:var(--w-trim)"><col style="width:var(--w-engine)">
          <col class="narrow-110"><col class="narrow-110">
          <col class="narrow-90"><col class="narrow-90"><col class="narrow-100"><col class="narrow-100">
          <col class="narrow-110"><col class="narrow-90"><col class="narrow-120"><col class="narrow-120">
          <col style="width:var(--w-actions)">
        </colgroup>
        <thead>
          <tr>
            <th class="sticky-brand">العلامة</th>
            <th class="sticky-model">الموديل</th>
            <th>السنة</th>
            <th class="sticky-trim">الفئة</th>
            <th>سعة المحرك</th>
            <th>اللون الخارجي</th><th>اللون الداخلي</th>
            <th>تصوير</th><th>مونتاج</th><th>صور + ريل مواصفات</th><th>ريل قصير</th><th>نوع المحتوى</th>
            <th>تاريخ التصوير</th><th>داخل الأجندة؟</th>
            <th>مرفوع على الموقع؟</th><th>رابط الصفحة</th><th>ملاحظات</th>
            <th class="sticky-actions">إجراءات</th>
          </tr>
        </thead>
        <tbody id="tbody"><tr><td colspan="17" style="padding:14px">جار التحميل…</td></tr></tbody>
      </table>
    </div>
      </div>

    </main>
  </div>

  <div class="toasts" id="toasts"></div>

  <script src="mzj-ui.js" defer></script>

</body>
</html>
