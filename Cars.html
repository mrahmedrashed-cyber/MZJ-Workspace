<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>MZJ â€” Production Tracker (Editor + Readonly Results)</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<style>
  :root{ --brown:#3e2420; --beige:#bc8f74; --cream:#fff8ef; --text:#1f2937; --muted:#6b7280; --danger:#ef4444; --shadow:0 6px 20px rgba(0,0,0,.06) }
  *{box-sizing:border-box}
  body{margin:0;background:var(--cream);color:var(--text);font-family:"Tajawal",system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;line-height:1.7}
  .container{max-width:1280px;margin:24px auto;padding:0 16px}
  .topbar{background:linear-gradient(135deg, rgba(62,36,32,.96), rgba(62,36,32,.85));color:#fff;border-radius:16px;padding:20px 18px;box-shadow:var(--shadow);display:flex;align-items:center;justify-content:space-between;gap:12px}
  .logo{width:42px;height:42px;border-radius:10px;background:var(--beige);display:grid;place-items:center;color:#fff;font-weight:800;box-shadow:inset 0 0 0 2px rgba(255,255,255,.35)}
  h1{margin:0;font-size:20px}
  .muted{color:#e8d9cf;font-size:12px}
  .actions{display:flex;gap:8px;flex-wrap:wrap}
  button,.btn{border:0;border-radius:12px;padding:10px 14px;font-weight:700;cursor:pointer}
  .btn-primary{background:var(--beige);color:#fff}
  .btn-secondary{background:#ffffff1a;color:#fff;border:1px solid #ffffff3a}
  .btn-ghost{background:#fff;color:var(--brown);border:1px solid #ece1d9}
  .btn-danger{background:var(--danger);color:#fff}
  .panel{background:#fff;border:1px solid #f0e6df;border-radius:16px;box-shadow:var(--shadow);padding:16px;margin-top:14px}
  .grid{display:grid;gap:12px}
  .grid-4{grid-template-columns:repeat(4,1fr)}
  @media (max-width:1100px){ .grid-4{grid-template-columns:repeat(2,1fr)} }
  @media (max-width:640px){ .grid-4{grid-template-columns:1fr} }
  .card{background:#fff;border:1px solid #f0e6df;border-radius:14px;padding:14px;box-shadow:var(--shadow)}
  .metric{display:flex;align-items:center;justify-content:space-between}
  .metric h3{margin:0;font-size:14px;color:var(--muted)}
  .metric strong{font-size:22px}
  label{font-weight:700;font-size:13px;color:var(--brown);display:block;margin-bottom:6px}
  input,select{width:100%;padding:10px 12px;border-radius:12px;border:1px solid #e7dbd2;background:#fff;outline:none;font-size:14px}
  input:focus,select:focus{border-color:var(--beige);box-shadow:0 0 0 3px rgba(188,143,116,.18)}
  .row{display:grid;grid-template-columns:repeat(6,1fr);gap:10px}
  @media (max-width:1100px){ .row{grid-template-columns:repeat(3,1fr)} }
  @media (max-width:640px){ .row{grid-template-columns:1fr} }

  /* Ø¬Ø¯Ø§ÙˆÙ„ */
  .table-soft{overflow:auto;border-radius:16px;border:1px solid #f0e6df}
  table{width:100%;border-collapse:separate;border-spacing:0;min-width:1400px;background:#fff}
  thead th{
    position:sticky;top:0;background:#fbf6f1;color:var(--brown);
    padding:12px 10px;border-bottom:1px solid #f0e6df;font-size:13px;z-index:2;text-align:right
  }
  tbody td{padding:10px;border-bottom:1px solid #f7eee7;font-size:13px;vertical-align:middle}
  tbody tr:nth-child(even){background:#fffdfa}

  /* Ø´Ø§Ø±Ø§Øª Ù„Ù„Ù‚Ø±Ø§Ø¡Ø© ÙÙ‚Ø· */
  .pill{display:inline-block;padding:6px 10px;border-radius:999px;border:1px solid #eaded6;font-weight:700;font-size:12px;background:#fff;white-space:nowrap}
  .p-green{background:#ecfdf5;border-color:#a7f3d0}
  .p-orange{background:#fff7ed;border-color:#fed7aa}
  .p-gray{background:#f3f4f6;border-color:#e5e7eb}
</style>
</head>
<body>
  <div class="container">
    <!-- Topbar -->
    <div class="topbar">
      <div style="display:flex;gap:12px;align-items:center">
        <div class="logo">MZJ</div>
        <div>
          <h1>Ù„ÙˆØ­Ø© Ù…ØªØ§Ø¨Ø¹Ø© Ø¥Ù†ØªØ§Ø¬ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù„Ù„Ø³ÙŠØ§Ø±Ø§Øª</h1>
          <div class="muted"> </div>
        </div>
      </div>
      <div class="actions">
        <button id="btnExportXLSX" class="btn btn-secondary">ØªØµØ¯ÙŠØ± XLSX</button>
        <label class="btn btn-secondary" for="xlsxImport" style="cursor:pointer">Ø§Ø³ØªÙŠØ±Ø§Ø¯ XLSX (Ø¥Ø¶Ø§ÙØ©)</label>
        <input id="xlsxImport" type="file" accept=".xlsx" style="display:none"/>
        <button id="btnTemplate" class="btn btn-ghost">ØªØ­Ù…ÙŠÙ„ Template XLSX</button>
        <button id="btnReset" class="btn btn-danger">ØªÙØ±ÙŠØº Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
      </div>
    </div>

    <!-- KPIs -->
    <div class="grid grid-4 panel" style="margin-top:14px">
      <div class="card metric"><h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</h3><strong id="kTotal">0</strong></div>
      <div class="card metric"><h3>ØªÙ… Ø§Ù„ØªØµÙˆÙŠØ±</h3><strong id="kShot">0</strong></div>
      <div class="card metric"><h3>ØªØ­Øª Ø§Ù„Ù…ÙˆÙ†ØªØ§Ø¬</h3><strong id="kEditing">0</strong></div>
      <div class="card metric"><h3>Ø¯Ø§Ø®Ù„ Ø§Ù„Ø£Ø¬Ù†Ø¯Ø©</h3><strong id="kAgenda">0</strong></div>
    </div>

    <!-- Ø¥Ø¶Ø§ÙØ© Ø³Ø±ÙŠØ¹Ø© + Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØ­Ø±ÙŠØ± -->
    <div class="panel">
      <h2 style="margin:0 0 10px 0;color:var(--brown);font-size:18px">Ø¥Ø¶Ø§ÙØ© Ø³ÙŠØ§Ø±Ø© Ø³Ø±ÙŠØ¹Ø©</h2>
      <div class="row">
        <div><label>Ø§Ù„Ø¹Ù„Ø§Ù…Ø©</label><select id="iBrand"></select></div>
        <div><label>Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„</label><select id="iModel" disabled></select></div>
        <div><label>Ø§Ù„Ø³Ù†Ø©</label><input id="iYear" type="number" min="2015" max="2030" value="2026"></div>
        <div><label>Ø§Ù„ÙØ¦Ø©</label><select id="iTrim"></select></div>
        <div><label>Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ</label><input id="iColor" placeholder="Ù…Ø«Ø§Ù„: Ø£Ø¨ÙŠØ¶ Ù„Ø¤Ù„Ø¤ÙŠ"></div>
        <div><label>Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ</label><input id="iIntColor" placeholder="Ù…Ø«Ø§Ù„: Ø¬Ù„Ø¯ Ø¨ÙŠØ¬"></div>
      </div>
      <div class="row" style="margin-top:10px">
        <div><label>Status â€“ ØªØµÙˆÙŠØ±</label><select id="iShoot"></select></div>
        <div><label>Status â€“ Ù…ÙˆÙ†ØªØ§Ø¬</label><select id="iEdit"></select></div>
        <div><label>Ù†ÙˆØ¹ Ø§Ù„Ù…Ø­ØªÙˆÙ‰</label><select id="iType"></select></div>
        <div><label>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØµÙˆÙŠØ±</label><input id="iShootDate" type="date"></div>
        <div><label>Ø¯Ø§Ø®Ù„ Ø§Ù„Ø£Ø¬Ù†Ø¯Ø©ØŸ</label><select id="iInAgenda"></select></div>
        <div id="agendaFields" class="hidden">
          <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø£Ø¬Ù†Ø¯Ø©</label>
          <div style="display:flex;gap:8px">
            <select id="iAgendaMonth"></select>
            <input id="iAgendaYear" type="number" min="2020" max="2035" value="">
          </div>
        </div>
      </div>
      <div class="row" style="margin-top:10px">
        <div><label>Ù…Ø±ÙÙˆØ¹ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹ØŸ</label><select id="iOnSite"></select></div>
        <div id="siteLinkField" class="hidden" style="grid-column: span 2">
          <label>Ø±Ø§Ø¨Ø· ØµÙØ­Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
          <input id="iSiteLink" placeholder="https://mzjcars.com/...">
        </div>
        <div style="grid-column: span 2"><label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label><input id="iNotes" placeholder="Ù…Ø«Ù„Ø§Ù‹: ÙŠÙ†ØªØ¸Ø± Ù…Ø±Ø§Ø¬Ø¹Ø© SEO / ØµÙˆØ± Ù†Ø§Ù‚ØµØ©"></div>
        <div><label>&nbsp;</label><button id="btnAdd" class="btn btn-primary" style="width:100%">Ø¥Ø¶Ø§ÙØ©</button></div>
      </div>
      <div class="muted" style="margin-top:6px">* Ø§Ù„Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠ. Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ XLSX ÙŠØ¶ÙŠÙ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯.</div>
    </div>

    <div class="panel table-soft" style="padding:0">
      <table id="carsTable">
        <thead>
          <tr>
            <th>Ø§Ù„Ø¹Ù„Ø§Ù…Ø©</th><th>Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„</th><th>Ø§Ù„Ø³Ù†Ø©</th><th>Ø§Ù„ÙØ¦Ø©</th>
            <th>Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ</th><th>Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ</th>
            <th>ØªØµÙˆÙŠØ±</th><th>Ù…ÙˆÙ†ØªØ§Ø¬</th><th>Ù†ÙˆØ¹ Ø§Ù„Ù…Ø­ØªÙˆÙ‰</th>
            <th>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØµÙˆÙŠØ±</th><th>Ø¯Ø§Ø®Ù„ Ø§Ù„Ø£Ø¬Ù†Ø¯Ø©ØŸ</th><th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø£Ø¬Ù†Ø¯Ø©</th>
            <th>Ù…Ø±ÙÙˆØ¹ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹ØŸ</th><th>Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙØ­Ø©</th><th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>

    <!-- Ø§Ù„ÙÙ„Ø§ØªØ± + Ù†ØªÙŠØ¬Ø© Ø§Ù„ÙÙ„ØªØ± (Ø¹Ø±Ø¶ ÙÙ‚Ø·) -->
    <div class="panel">
      <h2 style="margin:0 0 10px 0;color:var(--brown);font-size:18px">Ù†ØªÙŠØ¬Ø© Ø§Ù„ÙÙ„ØªØ± (Ø¹Ø±Ø¶ ÙÙ‚Ø·)</h2>
      <div class="row">
        <div><label>Ø§Ù„Ø¹Ù„Ø§Ù…Ø©</label><select id="dBrand"><option value="">Ø§Ù„ÙƒÙ„</option></select></div>
        <div><label>Ø§Ù„ÙØ¦Ø©</label><select id="dTrim"><option value="">Ø§Ù„ÙƒÙ„</option></select></div>
        <div><label>ØªØµÙˆÙŠØ±</label><select id="dShoot"><option value="">Ø§Ù„ÙƒÙ„</option></select></div>
        <div><label>Ù…ÙˆÙ†ØªØ§Ø¬</label><select id="dEdit"><option value="">Ø§Ù„ÙƒÙ„</option></select></div>
        <div><label>Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ</label><input id="dColor" placeholder="Ù…Ø«Ø§Ù„: Ø£Ø¨ÙŠØ¶"></div>
        <div><label>Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ</label><input id="dIntColor" placeholder="Ù…Ø«Ø§Ù„: Ø¨ÙŠØ¬"></div>
      </div>
      <div class="row" style="margin-top:10px">
        <div><label>Ø¯Ø§Ø®Ù„ Ø§Ù„Ø£Ø¬Ù†Ø¯Ø©ØŸ</label><select id="dAgenda"><option value="">Ø§Ù„ÙƒÙ„</option></select></div>
        <div style="grid-column: span 5"><label>Ø¨Ø­Ø« Ù†ØµÙ‘ÙŠ</label><input id="dSearch" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„/Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª/Ø§Ù„Ø£Ù„ÙˆØ§Ù†"></div>
      </div>
    </div>

    <div class="panel table-soft" style="padding:0;margin-top:8px">
      <table id="filteredTable">
        <thead>
          <tr>
            <th>Ø§Ù„Ø¹Ù„Ø§Ù…Ø©</th>
            <th>Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„</th>
            <th>Ø§Ù„Ø³Ù†Ø©</th>
            <th>Ø§Ù„ÙØ¦Ø©</th>
            <th>Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ</th>
            <th>Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ</th>
            <th>ØªØµÙˆÙŠØ±</th>
            <th>Ù…ÙˆÙ†ØªØ§Ø¬</th>
            <th>Ù†ÙˆØ¹ Ø§Ù„Ù…Ø­ØªÙˆÙ‰</th>
            <th>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØµÙˆÙŠØ±</th>
            <th>Ø¯Ø§Ø®Ù„ Ø§Ù„Ø£Ø¬Ù†Ø¯Ø©ØŸ</th>
            <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø£Ø¬Ù†Ø¯Ø©</th>
            <th>Ù…Ø±ÙÙˆØ¹ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹ØŸ</th>
            <th>Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙØ­Ø©</th>
            <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
          </tr>
        </thead>
        <tbody id="filteredTBody"></tbody>
      </table>
      <div class="muted" id="flatMeta" style="padding:10px"></div>
    </div>
  </div>

<script>
/* ===== Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ===== */
const BRANDS = ["Ù‡ÙŠÙˆÙ†Ø¯Ø§ÙŠ","Ø´Ø§Ù†Ø¬Ø§Ù†","Ø´ÙŠØ±ÙŠ","ÙÙˆØ±Ø¯","Ø§Ù… Ø¬ÙŠ","Ù†ÙŠØ³Ø§Ù†"];
const MODELS_BY_BRAND = {
  "Ù‡ÙŠÙˆÙ†Ø¯Ø§ÙŠ": ["Ø³ÙˆÙ†Ø§ØªØ§","Ø§Ù„Ù†ØªØ±Ø§","Ø§ÙƒØ³Ù†Øª","Ø¬Ø±Ø§Ù†Ø¯ i10","ÙƒØ±ÙŠØªØ§","Ø¬Ø±Ø§Ù†Ø¯ ÙƒØ±ÙŠØªØ§","Ø³ØªØ§Ø± Ø¬ÙŠØ²Ø±","ÙÙŠÙ†ÙŠÙˆ","Ø§Ø²ÙŠØ±Ø§","Ø³Ù†ØªØ§ÙÙŠ","ØªÙˆØ³Ø§Ù†","ÙƒÙˆÙ†Ø§","Ø³ØªØ§Ø±ÙŠØ§","Ø¨Ø§Ù„Ø³ÙŠÙŠØ¯"],
  "Ø´Ø§Ù†Ø¬Ø§Ù†": ["Ø³ÙŠ Ø§Ø³ 75","Ø³ÙŠ Ø§Ø³ 35","Ø§ÙŠØ¯Ùˆ Ø¨Ù„Ø³","Ø§Ù„ Ø³ÙŠÙÙ†","ÙŠÙˆÙ†ÙŠ ÙƒÙŠ","ÙŠÙˆÙ†ÙŠ ØªÙŠ","ÙŠÙˆÙ†ÙŠ ÙÙŠ","Ø³ÙŠ Ø§Ø³ 95","ÙŠÙˆÙ†ÙŠ Ø§Ø³","Ù‡Ø§Ù†ØªØ± Ø§Ø¨"],
  "Ø´ÙŠØ±ÙŠ": ["ØªÙŠØ¬Ùˆ 2 Ø¨Ø±Ùˆ","Ø§Ø±ÙŠØ²Ùˆ 8","Ø§Ø±ÙŠØ²Ùˆ 6 Ø¨Ø±Ùˆ","Ø§Ø±ÙŠØ²Ùˆ 5 Ø¨Ø±Ùˆ","Ø£ÙƒØ³ÙŠÙŠØ¯ Ø§Ù„ Ø§ÙƒØ³","ØªÙŠØ¬Ùˆ 8 Ø¨Ø±Ø©","ØªÙŠØ¬Ùˆ 7","ØªÙŠØ¬Ùˆ 4 Ø¨Ø±Ùˆ"],
  "ÙÙˆØ±Ø¯": ["Ø±ÙŠÙ†Ø¬Ø±","Ø§ÙƒØ³Ø¨Ù„ÙˆØ±","ØªÙŠØ±ÙŠØªÙˆØ±ÙŠ","ØªÙˆØ±Ø³"],
  "Ø§Ù… Ø¬ÙŠ": ["Ø¬ÙŠ ØªÙŠ","Ø§Ù… Ø¬ÙŠ 3","Ø§Ù… Ø¬ÙŠ 7","Ø§Ù… Ø¬ÙŠ 5","Ø§ØªØ´ Ø£Ø³","Ø§Ø± Ø§ÙƒØ³ 5","ÙˆÙ†","Ø²Ø¯ Ø£Ø³","ØªÙŠ 60","Ø§Ø± Ø£ÙƒØ³ 9","ÙˆØ§Ù„","Ø§Ø± Ø£ÙƒØ³ 8"],
  "Ù†ÙŠØ³Ø§Ù†": ["Ø§ÙƒØ³ ØªØ±ÙŠÙ„","Ù…Ø§Ø¬Ù†Ø§ÙŠØª","ÙƒÙŠÙƒØ³","ØµÙ†ÙŠ","Ø§ÙƒØ³ ØªÙŠØ±Ø§","Ø§Ù„ØªÙŠÙ…Ø§"]
};
const TRIMS  = ["Ø³ØªØ§Ù†Ø¯Ø±","Ø³Ù…Ø§Ø±Øª","Ø³Ù…Ø§Ø±Øª Ø¨Ù„Ø³","ÙƒÙˆÙ…ÙÙˆØ±Øª","ÙÙ„ ÙƒØ§Ù…Ù„","ØªØ±Ù†Ø¯","Ø§Ù…Ø¨ÙŠØ§Ù†ØªÙŠ","Ø±ÙˆÙŠÙ€Ø§Ù„"];
const SHOOT_STATUS = ["Ù„Ù… ÙŠÙØµÙˆÙ‘Ø±","ØªÙ… Ø§Ù„ØªØµÙˆÙŠØ±","Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ù…Ø±Ø§Ø¬Ø¹Ø©"];
const EDIT_STATUS  = ["Ù„Ù… ÙŠØ¨Ø¯Ø£","Ø¬Ø§Ø±ÙŠ","ØªÙ… Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡"];
const CONTENT_TYPES = ["ØµÙˆØ±","ÙÙŠØ¯ÙŠÙˆ","Ø±ÙŠÙ„","Ù…ÙˆØ´Ù†","AI"];
const YESNO = ["Ù„Ø§","Ù†Ø¹Ù…"];
const MONTHS = ["ÙŠÙ†Ø§ÙŠØ±","ÙØ¨Ø±Ø§ÙŠØ±","Ù…Ø§Ø±Ø³","Ø£Ø¨Ø±ÙŠÙ„","Ù…Ø§ÙŠÙˆ","ÙŠÙˆÙ†ÙŠÙˆ","ÙŠÙˆÙ„ÙŠÙˆ","Ø£ØºØ³Ø·Ø³","Ø³Ø¨ØªÙ…Ø¨Ø±","Ø£ÙƒØªÙˆØ¨Ø±","Ù†ÙˆÙÙ…Ø¨Ø±","Ø¯ÙŠØ³Ù…Ø¨Ø±"];

const LS_KEY = "mzj-cars-tracker";
let rows = loadRows() ?? sampleSeed();
let filters = {brand:"", trim:"", shoot:"", edit:"", color:"", intColor:"", agenda:"", q:""};

/* ===== Helpers ===== */
const $ = s=>document.querySelector(s);
function $fill(el, arr, withBlank=false, blankLabel="Ø§Ù„ÙƒÙ„"){
  el.innerHTML = withBlank ? `<option value="">${blankLabel}</option>` : "";
  arr.forEach(v=>{ const o=document.createElement("option"); o.value=v;o.textContent=v; el.appendChild(o); });
}
function $fillStrict(el, arr, withBlank=false){
  el.innerHTML = withBlank ? `<option value="">â€” Ø§Ø®ØªØ± â€”</option>` : "";
  arr.forEach(v=>{ const o=document.createElement("option"); o.value=v;o.textContent=v; el.appendChild(o); });
}
function escapeHTML(s){ return (s+"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;"); }

/* ===== ØªÙ‡ÙŠØ¦Ø© Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¶Ø§ÙØ© ===== */
$fillStrict($("#iBrand"), BRANDS, true);
$fillStrict($("#iTrim"), TRIMS);
$fillStrict($("#iShoot"), SHOOT_STATUS);
$fillStrict($("#iEdit"), EDIT_STATUS);
$fillStrict($("#iType"), CONTENT_TYPES);
$fillStrict($("#iInAgenda"), YESNO);
$fillStrict($("#iOnSite"), YESNO);
$fillStrict($("#iAgendaMonth"), MONTHS);
$("#iAgendaYear").value = new Date().getFullYear();

function refreshAddModels(){
  const b = $("#iBrand").value;
  const models = MODELS_BY_BRAND[b] || [];
  $("#iModel").disabled = models.length===0;
  $fillStrict($("#iModel"), models, true);
}
$("#iBrand").addEventListener("change", refreshAddModels);
refreshAddModels();

/* ===== ÙÙ„Ø§ØªØ± Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø¹Ø±Ø¶ ÙÙ‚Ø· ===== */
$fill($("#dBrand"), BRANDS, true, "Ø§Ù„ÙƒÙ„");
$fill($("#dTrim"), TRIMS, true, "Ø§Ù„ÙƒÙ„");
$fill($("#dShoot"), SHOOT_STATUS, true, "Ø§Ù„ÙƒÙ„");
$fill($("#dEdit"), EDIT_STATUS, true, "Ø§Ù„ÙƒÙ„");
$fill($("#dAgenda"), YESNO, true, "Ø§Ù„ÙƒÙ„");

/* ===== Ø­Ù‚ÙˆÙ„ Ø´Ø±Ø·ÙŠØ© Ø¨Ø§Ù„Ø¥Ø¶Ø§ÙØ© ===== */
$("#iInAgenda").addEventListener("change", ()=>$("#agendaFields").classList.toggle("hidden", $("#iInAgenda").value!=="Ù†Ø¹Ù…"));
$("#iOnSite").addEventListener("change", ()=>$("#siteLinkField").classList.toggle("hidden", $("#iOnSite").value!=="Ù†Ø¹Ù…"));
$("#agendaFields").classList.toggle("hidden", $("#iInAgenda").value!=="Ù†Ø¹Ù…");
$("#siteLinkField").classList.toggle("hidden", $("#iOnSite").value!=="Ù†Ø¹Ù…");

/* ===== Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØ­Ø±ÙŠØ± ===== */
function textCell(key,val,idx){ return `<input data-idx="${idx}" data-key="${key}" value="${escapeHTML(val??'')}" />` }
function numberCell(key,val,idx){ return `<input type="number" data-idx="${idx}" data-key="${key}" value="${escapeHTML(val??'')}" style="width:110px"/>` }
function dateCell(key,val,idx){ return `<input type="date" data-idx="${idx}" data-key="${key}" value="${val??''}" style="width:150px"/>` }
function linkCell(key,val,idx,label){
  const safe = val? escapeHTML(val):"";
  return `<div style="display:flex;gap:6px;align-items:center">
      <input data-idx="${idx}" data-key="${key}" value="${safe}" placeholder="https://..." style="min-width:220px"/>
      ${val?`<a class="btn btn-ghost" href="${safe}" target="_blank" rel="noopener">ÙØªØ­ ${label}</a>`:""}
    </div>`;
}
function selectCell(key, arr, val, idx, dataType){
  const options = arr.map(v=>`<option ${v===val?'selected':''} value="${v}">${v}</option>`).join("");
  const dt = dataType?`data-type="${dataType}"`:"";
  return `<select data-idx="${idx}" data-key="${key}" ${dt}>${options}</select>`;
}
function modelCell(key, val, brand, idx){
  const models = MODELS_BY_BRAND[brand] || [];
  const opts = [...models];
  if(val && !opts.includes(val)) opts.unshift(val);
  return `<select data-idx="${idx}" data-key="${key}" data-type="model">
    ${opts.map(v=>`<option ${v===val?'selected':''} value="${v}">${v}</option>`).join("")}
  </select>`;
}

function renderEditor(){
  const tb = $("#tbody"); tb.innerHTML = "";
  rows.forEach((r,idx)=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${selectCell("brand", BRANDS, r.brand, idx, 'brand')}</td>
      <td>${modelCell("model", r.model, r.brand, idx)}</td>
      <td>${numberCell("year", r.year, idx)}</td>
      <td>${selectCell("trim", TRIMS, r.trim, idx)}</td>
      <td>${textCell("color", r.color??"", idx)}</td>
      <td>${textCell("intColor", r.intColor??"", idx)}</td>
      <td>${selectCell("shoot", SHOOT_STATUS, r.shoot, idx)}</td>
      <td>${selectCell("edit", EDIT_STATUS, r.edit, idx)}</td>
      <td>${selectCell("ctype", CONTENT_TYPES, r.ctype, idx)}</td>
      <td>${dateCell("shootDate", r.shootDate, idx)}</td>
      <td>${selectCell("inAgenda", YESNO, r.inAgenda, idx)}</td>
      <td>${textCell("agendaDate", r.agendaDate??"", idx)}</td>
      <td>${selectCell("onSite", YESNO, r.onSite, idx)}</td>
      <td>${linkCell("siteLink", r.siteLink||"", idx, "Page")}</td>
      <td>${textCell("notes", r.notes??"", idx)}</td>
      <td>
        <button class="btn btn-ghost" data-action="dup" data-idx="${idx}">Ù†Ø³Ø®</button>
        <button class="btn btn-danger" data-action="del" data-idx="${idx}">Ø­Ø°Ù</button>
      </td>
    `;
    tb.appendChild(tr);
  });
}

/* ===== Ù†ØªÙŠØ¬Ø© Ø§Ù„ÙÙ„ØªØ± (Ø¹Ø±Ø¶ ÙÙ‚Ø·) ===== */
function badgePill(val, kind){
  const cls = kind==="green"?"p-green":kind==="orange"?"p-orange":"p-gray";
  return `<span class="pill ${cls}">${escapeHTML(val)}</span>`;
}
function currentListReadonly(){
  return rows.filter(r=>{
    if(filters.brand && r.brand!==filters.brand) return false;
    if(filters.trim && r.trim!==filters.trim) return false;
    if(filters.shoot && r.shoot!==filters.shoot) return false;
    if(filters.edit && r.edit!==filters.edit) return false;
    if(filters.color && !(r.color||"").toLowerCase().includes(filters.color.toLowerCase())) return false;
    if(filters.intColor && !(r.intColor||"").toLowerCase().includes(filters.intColor.toLowerCase())) return false;
    if(filters.agenda && r.inAgenda!==filters.agenda) return false;
    if(filters.q){
      const q = filters.q.trim().toLowerCase();
      const hay = `${r.brand} ${r.model} ${r.trim} ${r.color||""} ${r.intColor||""} ${r.notes||""}`.toLowerCase();
      if(!hay.includes(q)) return false;
    }
    return true;
  });
}
function renderFilteredTable(){
  const list = currentListReadonly();
  const tb = $("#filteredTBody");
  tb.innerHTML = "";
  if(!list.length){
    const tr=document.createElement("tr");
    tr.innerHTML = `<td colspan="15" style="padding:14px">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø©.</td>`;
    tb.appendChild(tr);
  } else {
    list.forEach(r=>{
      const shootP = r.shoot==="ØªÙ… Ø§Ù„ØªØµÙˆÙŠØ±" ? badgePill(r.shoot,"green") :
                     r.shoot==="Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ù…Ø±Ø§Ø¬Ø¹Ø©" ? badgePill(r.shoot,"orange") : badgePill(r.shoot,"gray");
      const editP  = r.edit==="ØªÙ… Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡" ? badgePill(r.edit,"green") :
                     r.edit==="Ø¬Ø§Ø±ÙŠ" ? badgePill(r.edit,"orange") : badgePill(r.edit,"gray");
      const agendaP= r.inAgenda==="Ù†Ø¹Ù…" ? badgePill("Ù†Ø¹Ù…","green") : badgePill("Ù„Ø§","gray");
      const siteP  = r.onSite==="Ù†Ø¹Ù…" ? badgePill("Ù†Ø¹Ù…","green") : badgePill("Ù„Ø§","gray");
      const link   = (r.onSite==="Ù†Ø¹Ù…" && r.siteLink) ? `<a href="${escapeHTML(r.siteLink)}" target="_blank" rel="noopener">${escapeHTML(r.siteLink)}</a>` : "â€”";
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${escapeHTML(r.brand||"â€”")}</td>
        <td>${escapeHTML(r.model||"â€”")}</td>
        <td>${escapeHTML(r.year||"â€”")}</td>
        <td>${escapeHTML(r.trim||"â€”")}</td>
        <td>${escapeHTML(r.color||"â€”")}</td>
        <td>${escapeHTML(r.intColor||"â€”")}</td>
        <td>${shootP}</td>
        <td>${editP}</td>
        <td>${escapeHTML(r.ctype||"â€”")}</td>
        <td>${escapeHTML(r.shootDate||"â€”")}</td>
        <td>${agendaP}</td>
        <td>${escapeHTML(r.agendaDate||"â€”")}</td>
        <td>${siteP}</td>
        <td>${link}</td>
        <td>${escapeHTML(r.notes||"â€”")}</td>
      `;
      tb.appendChild(tr);
    });
  }
  $("#flatMeta").textContent = `${list.length} Ù†ØªÙŠØ¬Ø© â€” Ø¹Ø±Ø¶ ÙÙ‚Ø· (Ø¨Ø¯ÙˆÙ† ØªØ¹Ø¯ÙŠÙ„)`;
}

/* ===== KPIs ===== */
function updateKPIs(){
  $("#kTotal").textContent   = rows.length;
  $("#kShot").textContent    = rows.filter(r=>r.shoot==="ØªÙ… Ø§Ù„ØªØµÙˆÙŠØ±").length;
  $("#kEditing").textContent = rows.filter(r=>r.edit==="Ø¬Ø§Ø±ÙŠ").length;
  $("#kAgenda").textContent  = rows.filter(r=>r.inAgenda==="Ù†Ø¹Ù…").length;
}

/* ===== Ø£Ø­Ø¯Ø§Ø« ===== */
document.addEventListener("change", e=>{
  const t = e.target;

  // ÙÙ„Ø§ØªØ± Ø§Ù„Ø¹Ø±Ø¶ ÙÙ‚Ø· (Ù„Ø§ ØªØ¹Ø¯Ù‘Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª)
  if(t.matches("#dBrand,#dTrim,#dShoot,#dEdit,#dAgenda")){
    filters.brand = $("#dBrand").value;
    filters.trim  = $("#dTrim").value;
    filters.shoot = $("#dShoot").value;
    filters.edit  = $("#dEdit").value;
    filters.agenda= $("#dAgenda").value;
    renderFilteredTable();
  }

  // ØªØºÙŠÙŠØ±Ø§Øª Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØ­Ø±ÙŠØ±
  if(t.matches("select[data-idx], input[data-idx]") && !t.closest("#filteredTable")){
    const idx = +t.dataset.idx; const key = t.dataset.key; const val = t.value;
    if(Number.isInteger(idx) && rows[idx]){
      rows[idx][key] = val;
      if(key==="brand"){
        const allowed = MODELS_BY_BRAND[val] || [];
        if(!allowed.includes(rows[idx].model)){ rows[idx].model = allowed[0] || ""; }
      }
      saveRows(); updateKPIs(); renderEditor(); renderFilteredTable();
    }
  }
});
document.addEventListener("input", e=>{
  const t = e.target;
  if(t.id==="dSearch"){ filters.q = t.value; renderFilteredTable(); }
  if(t.id==="dColor"){ filters.color = t.value; renderFilteredTable(); }
  if(t.id==="dIntColor"){ filters.intColor = t.value; renderFilteredTable(); }
});

document.addEventListener("click", e=>{
  const btn = e.target.closest("button"); if(!btn) return;
  if(btn.id==="btnAdd"){ addQuick(); }
  if(btn.id==="btnExportXLSX"){ exportXLSX(); }
  if(btn.id==="btnTemplate"){ downloadTemplate(); }
  if(btn.id==="btnReset"){ if(confirm("Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ")){ rows=[]; saveRows(); updateKPIs(); renderEditor(); renderFilteredTable(); } }
  if(btn.dataset.action==="del"){ rows.splice(+btn.dataset.idx,1); saveRows(); updateKPIs(); renderEditor(); renderFilteredTable(); }
  if(btn.dataset.action==="dup"){ rows.splice(+btn.dataset.idx,0, JSON.parse(JSON.stringify(rows[+btn.dataset.idx])) ); saveRows(); updateKPIs(); renderEditor(); renderFilteredTable(); }
});

$("#xlsxImport").addEventListener("change", onImportXLSX);

/* ===== Ø¥Ø¶Ø§ÙØ© Ø³Ø±ÙŠØ¹Ø© ===== */
function addQuick(){
  const agendaMonth = $("#iAgendaMonth").value; 
  const agendaYear  = ($("#iAgendaYear").value||"").trim();
  const agendaDate  = ($("#iInAgenda").value==="Ù†Ø¹Ù…" && agendaMonth && agendaYear) ? `${agendaMonth} ${agendaYear}` : "";

  const r = {
    brand: $("#iBrand").value || "",
    model: $("#iModel").value || "",
    year:  +($("#iYear").value || 2026),
    trim:  $("#iTrim").value || TRIMS[0],
    color: ($("#iColor").value || "").trim(),
    intColor: ($("#iIntColor").value || "").trim(),
    shoot: $("#iShoot").value || SHOOT_STATUS[0],
    edit:  $("#iEdit").value || EDIT_STATUS[0],
    ctype: $("#iType").value || CONTENT_TYPES[0],
    shootDate: $("#iShootDate").value || "",
    inAgenda: $("#iInAgenda").value || "Ù„Ø§",
    agendaDate,
    onSite: $("#iOnSite").value || "Ù„Ø§",
    siteLink: ($("#iOnSite").value==="Ù†Ø¹Ù…" ? ($("#iSiteLink").value||"") : ""),
    notes: $("#iNotes").value || ""
  };
  rows.unshift(r); saveRows();
  ["iModel","iColor","iIntColor","iNotes","iShootDate","iSiteLink"].forEach(id=>$("#"+id).value="");
  $("#iInAgenda").value = "Ù„Ø§"; $("#agendaFields").classList.add("hidden");
  $("#iOnSite").value = "Ù„Ø§"; $("#siteLinkField").classList.add("hidden");
  updateKPIs(); renderEditor(); renderFilteredTable();
}

/* ===== XLSX I/O ===== */
function xlsxHeaders(){ return ["brand","model","year","trim","color","intColor","shoot","edit","ctype","shootDate","inAgenda","agendaDate","onSite","siteLink","notes"]; }
function exportXLSX(){
  const headers = xlsxHeaders();
  const data = rows.map(r=>{ const o={}; headers.forEach(h=>o[h]=r[h]??""); return o; });
  const ws = XLSX.utils.json_to_sheet(data, {header: headers});
  const wb = XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb, ws, "MZJ Cars");
  XLSX.writeFile(wb, "mzj-production-tracker.xlsx");
}
function onImportXLSX(e){
  const file = e.target.files[0]; if(!file) return;
  const reader = new FileReader();
  reader.onload = (evt)=>{
    const data = new Uint8Array(evt.target.result);
    const wb = XLSX.read(data, {type: "array"});
    const ws = wb.Sheets[wb.SheetNames[0]];
    const json = XLSX.utils.sheet_to_json(ws, {defval:""});
    if(!json.length){ alert("Ø§Ù„Ù…Ù„Ù ÙØ§Ø±Øº."); return; }
    const req = xlsxHeaders(); const cols = Object.keys(json[0]||{});
    const ok = req.every(h=>cols.includes(h));
    if(!ok){ alert("ØµÙŠØºØ© XLSX ØºÙŠØ± Ù…Ø·Ø§Ø¨Ù‚Ø©. Ø­Ù…Ù‘Ù„ Ø§Ù„Ù€Template Ø£Ø¹Ù„Ø§Ù‡."); return; }
    const imported = json.map(row=>{ const o={}; req.forEach(h=>o[h]=row[h]??""); o.year=+o.year||2026; return o; });
    rows = rows.concat(imported); saveRows(); updateKPIs(); renderEditor(); renderFilteredTable();
    alert(`ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ ${imported.length} Ø³ÙŠØ§Ø±Ø© (Ø¥Ø¶Ø§ÙØ©).`);
  };
  reader.readAsArrayBuffer(file);
}
function downloadTemplate(){
  const headers = xlsxHeaders();
  const sample = [{
    brand:"Ù‡ÙŠÙˆÙ†Ø¯Ø§ÙŠ", model:"Ø³ÙˆÙ†Ø§ØªØ§", year:2026, trim:"Ø³Ù…Ø§Ø±Øª",
    color:"Ø£Ø¨ÙŠØ¶ Ù„Ø¤Ù„Ø¤ÙŠ", intColor:"Ø£Ø³ÙˆØ¯", shoot:"ØªÙ… Ø§Ù„ØªØµÙˆÙŠØ±", edit:"Ø¬Ø§Ø±ÙŠ",
    ctype:"Ø±ÙŠÙ„", shootDate:"2025-10-12", inAgenda:"Ù†Ø¹Ù…", agendaDate:"Ø£ÙƒØªÙˆØ¨Ø± 2025",
    onSite:"Ù„Ø§", siteLink:"", notes:"Ù…Ø«Ø§Ù„: ÙŠÙ†ØªØ¸Ø± ÙÙˆÙŠØ³"
  }];
  const ws = XLSX.utils.json_to_sheet(sample, {header: headers});
  const wb = XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb, ws, "Template");
  XLSX.writeFile(wb, "mzj-quick-add-template.xlsx");
}

/* ===== ØªØ®Ø²ÙŠÙ† Ù…Ø­Ù„ÙŠ + Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø«Ø§Ù„ ===== */
function saveRows(){ localStorage.setItem(LS_KEY, JSON.stringify(rows)); }
function loadRows(){ try{ return JSON.parse(localStorage.getItem(LS_KEY)||"null"); }catch(e){ return null; } }
function sampleSeed(){
  return [
    {brand:"Ù‡ÙŠÙˆÙ†Ø¯Ø§ÙŠ",model:"Ø³ÙˆÙ†Ø§ØªØ§",year:2026,trim:"Ø³Ù…Ø§Ø±Øª",color:"Ø£Ø¨ÙŠØ¶ Ù„Ø¤Ù„Ø¤ÙŠ",intColor:"Ø£Ø³ÙˆØ¯",shoot:"ØªÙ… Ø§Ù„ØªØµÙˆÙŠØ±",edit:"Ø¬Ø§Ø±ÙŠ",ctype:"Ø±ÙŠÙ„",shootDate:"2025-10-12",inAgenda:"Ù†Ø¹Ù…",agendaDate:"Ø£ÙƒØªÙˆØ¨Ø± 2025",onSite:"Ù„Ø§",siteLink:"",notes:"Ø¨Ø§Ù†ØªØ¸Ø§Ø± ÙÙˆÙŠØ³ Ø³Ø¹ÙˆØ¯ÙŠ"},
    {brand:"Ù†ÙŠØ³Ø§Ù†",model:"Ø§ÙƒØ³ ØªØ±ÙŠÙ„",year:2025,trim:"Ø³ØªØ§Ù†Ø¯Ø±",color:"Ø±Ù…Ø§Ø¯ÙŠ",intColor:"Ø¨ÙŠØ¬",shoot:"Ù„Ù… ÙŠÙØµÙˆÙ‘Ø±",edit:"Ù„Ù… ÙŠØ¨Ø¯Ø£",ctype:"ØµÙˆØ±",shootDate:"",inAgenda:"Ù„Ø§",agendaDate:"",onSite:"Ù„Ø§",siteLink:"",notes:"Ø£ÙˆÙ„ÙˆÙŠØ© Ø¹Ø§Ù„ÙŠØ©"},
    {brand:"ÙÙˆØ±Ø¯",model:"ØªÙŠØ±ÙŠØªÙˆØ±ÙŠ",year:2026,trim:"ØªØ±Ù†Ø¯",color:"Ø£Ø³ÙˆØ¯",intColor:"Ø¬Ù„Ø¯ Ø¨ÙŠØ¬",shoot:"ØªÙ… Ø§Ù„ØªØµÙˆÙŠØ±",edit:"ØªÙ… Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡",ctype:"ÙÙŠØ¯ÙŠÙˆ",shootDate:"2025-09-28",inAgenda:"Ù†Ø¹Ù…",agendaDate:"Ø£ÙƒØªÙˆØ¨Ø± 2025",onSite:"Ù†Ø¹Ù…",siteLink:"https://mzjcars.com/ford-territory-trend-2026",notes:"Ø¬Ø§Ù‡Ø² Ù„Ù„Ù…ÙˆÙ‚Ø¹"}
  ];
}

/* ===== ØªØ´ØºÙŠÙ„ Ø£ÙˆÙ„ÙŠ ===== */
function boot(){ updateKPIs(); renderEditor(); renderFilteredTable(); }
boot();
</script>
</body>
  <!-- Firebase Setup -->
<script type="module">
  // ğŸ“¦ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…ÙƒØªØ¨Ø§Øª Firebase
  import { initializeApp, getApps } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";
  import {
    getFirestore, collection, addDoc, getDocs, getDoc, setDoc, updateDoc, deleteDoc, doc, query, where, serverTimestamp
  } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";

  // âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯ Firebase Ø¨Ù†ÙØ³ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯
  const firebaseConfig = {
    apiKey: "AIzaSyBVNNtGz9zGefzmNIosRrwgJGROsu5SNIw",
    authDomain: "mzj-workspace.firebaseapp.com",
    projectId: "mzj-workspace",
    storageBucket: "mzj-workspace.firebasestorage.app",
    appId: "1:1043260904465:web:8742de3a3ac727ae1e8db0"
  };

  // âœ… Ø§Ù„ØªÙ‡ÙŠØ¦Ø©
  if (!getApps().length) initializeApp(firebaseConfig);
  const auth = getAuth();
  const db   = getFirestore();

  // ğŸ” ØªØ£ÙƒÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
  onAuthStateChanged(auth, (user)=>{
    if(!user){
      alert("ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
      location.href = "login.html";
    }else{
      console.log("âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„:", user.email);
      document.getElementById("welcome").textContent = "Ù…Ø±Ø­Ø¨Ù‹Ø§ " + (user.displayName || user.email);
    }
  });

  // ğŸ’¾ Ù…Ø«Ø§Ù„: Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø³ÙŠØ·Ø© ÙÙŠ Firestore
  document.getElementById("btnSave")?.addEventListener("click", async ()=>{
    const name  = document.getElementById("name").value.trim();
    const notes = document.getElementById("notes").value.trim();

    if(!name) return alert("âš ï¸ Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù… Ø£ÙˆÙ„Ø§Ù‹");

    try{
      await addDoc(collection(db, "test_data"), {
        name,
        notes,
        createdAt: serverTimestamp(),
        createdBy: auth.currentUser?.uid || "unknown"
      });
      alert("âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­");
    }catch(err){
      console.error(err);
      alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸");
    }
  });

  // ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
  window.logout = async ()=>{
    await signOut(auth);
    location.href = "login.html";
  };
</script>

</html>
